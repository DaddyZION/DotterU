<!-- overlay.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Stream Character Overlay</title>
  <style>
    body { margin: 0; overflow: hidden; background: #181828; }
    #overlay {
      width: 1920px;
      height: 1080px;
      position: relative;
      margin: 0 auto;
      background: #181828;
      box-shadow: 0 0 32px #000a;
      overflow: hidden;
      border-radius: 18px;
    }
    .character {
      position: absolute;
      width: 18px;   /* 56px / 3 â‰ˆ 18px */
      height: 18px;
      border-radius: 50%;
      box-shadow: 0 2px 8px rgba(0,0,0,0.35);
      border: 2px solid #fff8;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: left 0.1s, top 0.1s, box-shadow 0.2s;
    }
  </style>
</head>
<body>
  <div id="overlay"></div>
  <script>
const socket = new WebSocket('wss://dotteru.onrender.com');
const overlay = document.getElementById('overlay');
const characters = {}; // username: { div, x, y, tx, ty, color }

function lerp(a, b, t) {
  return a + (b - a) * t;
}

socket.onmessage = function(event) {
  const msg = JSON.parse(event.data);
  if (msg.type === 'state') {
    // Mark all as not updated
    Object.values(characters).forEach(c => c.updated = false);

    msg.users.forEach(user => {
      let c = characters[user.username];
      if (!c) {
        // Create new character
        const div = document.createElement('div');
        div.className = 'character';
        overlay.appendChild(div);
        c = characters[user.username] = {
          div,
          x: user.x, y: user.y,
          tx: user.x, ty: user.y,
          color: user.color
        };
      }
      c.tx = user.x;
      c.ty = user.y;
      c.color = user.color;
      c.updated = true;
    });

    // Remove characters not in update
    for (const [username, c] of Object.entries(characters)) {
      if (!c.updated) {
        overlay.removeChild(c.div);
        delete characters[username];
      }
    }
  }
};

// Animation loop for interpolation
function animate() {
  for (const c of Object.values(characters)) {
    c.x = lerp(c.x, c.tx, 0.25); // 0.25 = smoothing factor
    c.y = lerp(c.y, c.ty, 0.25);
    c.div.style.left = c.x + 'px';
    c.div.style.top = c.y + 'px';
    c.div.style.background = c.color;
  }
  requestAnimationFrame(animate);
}
animate();
  </script>
</body>
</html>